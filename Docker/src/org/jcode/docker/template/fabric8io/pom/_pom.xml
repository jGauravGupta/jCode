<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>org.netbeans.jpamodeler</groupId>
    <artifactId>docker_pom</artifactId>
    <version>1.0-SNAPSHOT</version>

    <profiles>
        <profile>
            <id>docker</id>
            <build>
                <finalName>${build.name}</finalName>
                <plugins>
                    <plugin>
                        <groupId>io.fabric8</groupId>
                        <artifactId>docker-maven-plugin</artifactId>
                        <version>${version.fabric8}</version>
                        <executions>
                            <execution>
                                <id>docker:build</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>build</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>docker:start</id>
                                <phase>install</phase>
                                <goals>
                                    <goal>start</goal>
                                </goals>
                            </execution>
                        </executions>
                        <configuration>
                            <images>
                                <image>
                                    <alias>${web.svc}</alias>
                                    <name>${docker.image}</name>
                                    <build>
                                        <!--<args>
                                            <BINARY>maven/${project.build.finalName}.war</BINARY>
                                            <DB_DATASOURCE>ds</DB_DATASOURCE>
                                            <DB_NAME>sample</DB_NAME>
                                            <DB_USER>root</DB_USER>
                                            <DB_PASS>root</DB_PASS>
                                        </args>
                                        <dockerFileDir>${project.basedir}/src/main/docker</dockerFileDir>-->
                                        <assembly>
                                            <!--<descriptorRef>artifact</descriptorRef>
                                            <basedir>/</basedir>-->
                                            <inline>
                                                <files>
                                                    <file>                                                   
                                                        <source>${project.binary}</source>
                                                        <!--<outputDirectory>/myfolder</outputDirectory>-->
                                                    </file>
                                                </files>
                                            </inline>
                                        </assembly>
                                    </build>
                                     <external> 
                                        <type>compose</type> 
                                        <basedir>/src/main/docker/</basedir> 
                                        <composeFile>docker-compose.yml</composeFile>
                                    </external>
<!--                                <run>
                                        <links>
                                            <link>db</link>
                                        </links>
                                        <ports>
                                            <port>${server.port}:8080</port>
                                            <port>${server.port.admin}:8081</port>
                                        </ports>
                                    </run>-->
                                </image>
<!--                                <image>
                                    <alias>db</alias>
                                    <name>postgres:latest</name>
                                    <run>
                                        <env>
                                            <POSTGRES_USER>root</POSTGRES_USER>
                                            <POSTGRES_PASSWORD>root</POSTGRES_PASSWORD>
                                            <POSTGRES_DB>sample</POSTGRES_DB>
                                        </env>
                                        <ports>
                                            <port>15432:5432</port>
                                        </ports>
                                    </run>
                                </image>-->
                            </images>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
            <properties>
                <version.fabric8>0.22.1</version.fabric8>

                <build.name>${project.artifactId}</build.name>
                <project.binary>${project.build.directory}/${binary}</project.binary>
                <docker.binary>maven/${binary}</docker.binary>
                
                <docker.image>${project.groupId}/${project.artifactId}:${project.version}</docker.image>
            </properties>
        </profile>
    </profiles>
</project>
